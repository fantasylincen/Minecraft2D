<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCv2 - 物品栏系统测试</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        .test-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .test-controls button {
            padding: 10px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-controls button:hover {
            background: #45a049;
        }
        
        .test-controls button.danger {
            background: #f44336;
        }
        
        .test-controls button.danger:hover {
            background: #da190b;
        }
        
        .test-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .inventory-demo {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        
        .inventory-info {
            flex: 1;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 4px;
        }
        
        /* 引入物品栏样式 */
        .item-slot {
            position: relative;
            width: 48px;
            height: 48px;
            border: 2px solid #8B8B8B;
            background: #373737;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-sizing: border-box;
            margin: 2px;
        }
        
        .item-slot:hover {
            border-color: #FFFFFF;
            background: #4A4A4A;
        }
        
        .item-slot.selected {
            border-color: #FFFFFF;
            background: #5A5A5A;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
        }
        
        .item-icon {
            font-size: 24px;
            line-height: 1;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        .item-count {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 12px;
            font-weight: bold;
            color: #FFFFFF;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            min-width: 12px;
            text-align: center;
        }
        
        .hotbar-demo {
            display: flex;
            gap: 4px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            border-radius: 8px;
            border: 2px solid #555555;
            margin-bottom: 20px;
        }
        
        .inventory-grid-demo {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 4px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>MCv2 - 物品栏系统测试</h1>
            <p>测试物品栏和背包的基本功能</p>
        </div>
        
        <div class="test-section">
            <h2>测试控制</h2>
            <div class="test-controls">
                <button onclick="testBasicOperations()">基础操作测试</button>
                <button onclick="testStackOperations()">堆叠操作测试</button>
                <button onclick="testInventoryOperations()">物品栏操作测试</button>
                <button onclick="testSaveLoad()">保存/加载测试</button>
                <button onclick="addRandomItems()">添加随机物品</button>
                <button onclick="clearInventory()" class="danger">清空物品栏</button>
                <button onclick="showInventoryState()">显示物品栏状态</button>
            </div>
            
            <div class="test-output" id="testOutput"></div>
        </div>
        
        <div class="test-section">
            <h2>物品栏演示</h2>
            <div class="inventory-demo">
                <div>
                    <h3>快捷栏 (当前选中: <span id="selectedSlot">0</span>)</h3>
                    <div class="hotbar-demo" id="hotbarDemo"></div>
                    
                    <h3>背包</h3>
                    <div class="inventory-grid-demo" id="inventoryDemo"></div>
                    
                    <div class="test-controls">
                        <button onclick="selectSlot(0)">选择槽位0</button>
                        <button onclick="selectSlot(1)">选择槽位1</button>
                        <button onclick="selectSlot(2)">选择槽位2</button>
                        <button onclick="selectSlot(3)">选择槽位3</button>
                        <button onclick="selectSlot(4)">选择槽位4</button>
                    </div>
                </div>
                
                <div class="inventory-info">
                    <h3>物品栏信息</h3>
                    <div id="inventoryInfo">
                        <p>空槽位: <span id="emptySlots">36</span></p>
                        <p>总槽位: <span id="totalSlots">36</span></p>
                        <p>当前手持: <span id="heldItem">无</span></p>
                    </div>
                    
                    <h3>快速测试</h3>
                    <div class="test-controls">
                        <button onclick="addTestItem('pickaxe_wood')">添加木镐</button>
                        <button onclick="addTestItem('block_dirt', 64)">添加泥土x64</button>
                        <button onclick="addTestItem('apple', 10)">添加苹果x10</button>
                        <button onclick="addTestItem('diamond', 5)">添加钻石x5</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 导入物品栏相关模块 -->
    <script type="module">
        import { Inventory, ItemSlot } from './src/player/Inventory.js';
        import { itemConfig, ItemConfig } from './src/config/ItemConfig.js';
        
        // 创建全局测试实例
        window.testInventory = new Inventory();
        window.itemConfig = itemConfig;
        
        // 测试输出函数
        function log(message) {
            const output = document.getElementById('testOutput');
            const now = new Date().toLocaleTimeString();
            output.innerHTML += `[${now}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        // 基础操作测试
        window.testBasicOperations = function() {
            log('=== 基础操作测试开始 ===');
            
            // 测试物品添加
            log('测试添加物品...');
            const remaining1 = window.testInventory.addItem('block_dirt', 10);
            log(`添加泥土x10，剩余: ${remaining1}`);
            
            const remaining2 = window.testInventory.addItem('pickaxe_wood', 1);
            log(`添加木镐x1，剩余: ${remaining2}`);
            
            // 测试物品检查
            const hasItem1 = window.testInventory.hasItem('block_dirt', 5);
            log(`检查是否有泥土x5: ${hasItem1}`);
            
            const hasItem2 = window.testInventory.hasItem('pickaxe_iron', 1);
            log(`检查是否有铁镐x1: ${hasItem2}`);
            
            // 测试物品移除
            const removed = window.testInventory.removeItem('block_dirt', 3);
            log(`移除泥土x3，实际移除: ${removed}`);
            
            updateDisplay();
            log('=== 基础操作测试完成 ===');
        };
        
        // 堆叠操作测试
        window.testStackOperations = function() {
            log('=== 堆叠操作测试开始 ===');
            
            // 测试可堆叠物品
            log('测试可堆叠物品...');
            window.testInventory.addItem('block_stone', 30);
            window.testInventory.addItem('block_stone', 40);
            log('添加石头30+40个');
            
            // 测试不可堆叠物品
            log('测试不可堆叠物品...');
            window.testInventory.addItem('pickaxe_stone', 1);
            window.testInventory.addItem('pickaxe_stone', 1);
            log('添加石镐1+1个');
            
            updateDisplay();
            log('=== 堆叠操作测试完成 ===');
        };
        
        // 物品栏操作测试
        window.testInventoryOperations = function() {
            log('=== 物品栏操作测试开始 ===');
            
            // 测试槽位选择
            window.testInventory.setSelectedHotbarSlot(3);
            log('选择快捷栏槽位3');
            
            const heldItem = window.testInventory.getHeldItem();
            if (!heldItem.isEmpty()) {
                const item = heldItem.getItemDefinition();
                log(`当前手持: ${item?.name || heldItem.itemId} x${heldItem.count}`);
            } else {
                log('当前手持: 无');
            }
            
            // 测试物品栏状态
            const emptySlots = window.testInventory.getEmptySlotCount();
            const isFull = window.testInventory.isFull();
            log(`空槽位数量: ${emptySlots}`);
            log(`物品栏是否已满: ${isFull}`);
            
            updateDisplay();
            log('=== 物品栏操作测试完成 ===');
        };
        
        // 保存/加载测试
        window.testSaveLoad = function() {
            log('=== 保存/加载测试开始 ===');
            
            // 保存当前状态
            const saveData = window.testInventory.toSaveData();
            log('物品栏状态已保存到内存');
            
            // 清空物品栏
            window.testInventory.clear();
            log('物品栏已清空');
            updateDisplay();
            
            // 等待一秒后恢复
            setTimeout(() => {
                window.testInventory.fromSaveData(saveData);
                log('物品栏状态已恢复');
                updateDisplay();
                log('=== 保存/加载测试完成 ===');
            }, 1000);
        };
        
        // 添加随机物品
        window.addRandomItems = function() {
            const items = [
                'block_dirt', 'block_stone', 'block_grass', 'block_sand',
                'pickaxe_wood', 'pickaxe_stone', 'apple', 'bread',
                'iron_ingot', 'gold_ingot', 'diamond'
            ];
            
            for (let i = 0; i < 5; i++) {
                const randomItem = items[Math.floor(Math.random() * items.length)];
                const randomCount = Math.floor(Math.random() * 20) + 1;
                window.testInventory.addItem(randomItem, randomCount);
            }
            
            log('添加了5个随机物品');
            updateDisplay();
        };
        
        // 清空物品栏
        window.clearInventory = function() {
            window.testInventory.clear();
            log('物品栏已清空');
            updateDisplay();
        };
        
        // 显示物品栏状态
        window.showInventoryState = function() {
            log('=== 物品栏状态 ===');
            window.testInventory.debugPrint();
            log('详细状态已输出到浏览器控制台');
        };
        
        // 选择槽位
        window.selectSlot = function(index) {
            window.testInventory.setSelectedHotbarSlot(index);
            updateDisplay();
            log(`选择了快捷栏槽位 ${index}`);
        };
        
        // 添加测试物品
        window.addTestItem = function(itemId, count = 1) {
            const remaining = window.testInventory.addItem(itemId, count);
            const item = window.itemConfig.getItem(itemId);
            if (remaining > 0) {
                log(`添加 ${item?.name || itemId} x${count - remaining}，剩余 ${remaining} 个无法添加（物品栏已满）`);
            } else {
                log(`成功添加 ${item?.name || itemId} x${count}`);
            }
            updateDisplay();
        };
        
        // 获取物品图标
        function getItemIcon(item) {
            if (!item) return '';
            
            const iconMap = {
                'block_dirt': '🟫',
                'block_stone': '⬜',
                'block_grass': '🟩',
                'block_sand': '🟨',
                'block_water': '🟦',
                'block_wood': '🟤',
                'block_leaves': '🍃',
                'block_iron_ore': '⚪',
                'block_gold_ore': '🟡',
                'block_diamond_ore': '💎',
                'pickaxe_wood': '⛏️',
                'pickaxe_stone': '🔨',
                'pickaxe_iron': '⚒️',
                'pickaxe_diamond': '💎⛏️',
                'iron_ingot': '🔗',
                'gold_ingot': '🥇',
                'diamond': '💎',
                'stick': '🪵',
                'apple': '🍎',
                'bread': '🍞'
            };
            
            return iconMap[item.id] || '❓';
        }
        
        // 更新显示
        function updateDisplay() {
            const hotbarElement = document.getElementById('hotbarDemo');
            const inventoryElement = document.getElementById('inventoryDemo');
            
            // 更新快捷栏
            hotbarElement.innerHTML = '';
            window.testInventory.hotbar.forEach((slot, index) => {
                const slotElement = document.createElement('div');
                slotElement.className = `item-slot ${window.testInventory.selectedHotbarSlot === index ? 'selected' : ''}`;
                
                if (!slot.isEmpty()) {
                    const item = slot.getItemDefinition();
                    slotElement.innerHTML = `
                        <div class="item-icon">${getItemIcon(item)}</div>
                        <div class="item-count">${slot.count > 1 ? slot.count : ''}</div>
                    `;
                }
                
                slotElement.onclick = () => selectSlot(index);
                hotbarElement.appendChild(slotElement);
            });
            
            // 更新背包
            inventoryElement.innerHTML = '';
            window.testInventory.mainInventory.forEach((slot, index) => {
                const slotElement = document.createElement('div');
                slotElement.className = 'item-slot';
                
                if (!slot.isEmpty()) {
                    const item = slot.getItemDefinition();
                    slotElement.innerHTML = `
                        <div class="item-icon">${getItemIcon(item)}</div>
                        <div class="item-count">${slot.count > 1 ? slot.count : ''}</div>
                    `;
                }
                
                inventoryElement.appendChild(slotElement);
            });
            
            // 更新信息
            document.getElementById('selectedSlot').textContent = window.testInventory.selectedHotbarSlot;
            document.getElementById('emptySlots').textContent = window.testInventory.getEmptySlotCount();
            document.getElementById('totalSlots').textContent = window.testInventory.getAllSlots().length;
            
            const heldItem = window.testInventory.getHeldItem();
            if (!heldItem.isEmpty()) {
                const item = heldItem.getItemDefinition();
                document.getElementById('heldItem').textContent = `${item?.name || heldItem.itemId} x${heldItem.count}`;
            } else {
                document.getElementById('heldItem').textContent = '无';
            }
        }
        
        // 初始化显示
        updateDisplay();
        log('物品栏系统测试页面已加载');
        log('请使用上方按钮测试各项功能');
        
        window.log = log;
        window.updateDisplay = updateDisplay;
    </script>
</body>
</html>