<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCv2 - ç‰©å“æ ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        .test-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .test-controls button {
            padding: 10px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-controls button:hover {
            background: #45a049;
        }
        
        .test-controls button.danger {
            background: #f44336;
        }
        
        .test-controls button.danger:hover {
            background: #da190b;
        }
        
        .test-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .inventory-demo {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        
        .inventory-info {
            flex: 1;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 4px;
        }
        
        /* å¼•å…¥ç‰©å“æ æ ·å¼ */
        .item-slot {
            position: relative;
            width: 48px;
            height: 48px;
            border: 2px solid #8B8B8B;
            background: #373737;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-sizing: border-box;
            margin: 2px;
        }
        
        .item-slot:hover {
            border-color: #FFFFFF;
            background: #4A4A4A;
        }
        
        .item-slot.selected {
            border-color: #FFFFFF;
            background: #5A5A5A;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
        }
        
        .item-icon {
            font-size: 24px;
            line-height: 1;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        .item-count {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 12px;
            font-weight: bold;
            color: #FFFFFF;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            min-width: 12px;
            text-align: center;
        }
        
        .hotbar-demo {
            display: flex;
            gap: 4px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            border-radius: 8px;
            border: 2px solid #555555;
            margin-bottom: 20px;
        }
        
        .inventory-grid-demo {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 4px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>MCv2 - ç‰©å“æ ç³»ç»Ÿæµ‹è¯•</h1>
            <p>æµ‹è¯•ç‰©å“æ å’ŒèƒŒåŒ…çš„åŸºæœ¬åŠŸèƒ½</p>
        </div>
        
        <div class="test-section">
            <h2>æµ‹è¯•æ§åˆ¶</h2>
            <div class="test-controls">
                <button onclick="testBasicOperations()">åŸºç¡€æ“ä½œæµ‹è¯•</button>
                <button onclick="testStackOperations()">å †å æ“ä½œæµ‹è¯•</button>
                <button onclick="testInventoryOperations()">ç‰©å“æ æ“ä½œæµ‹è¯•</button>
                <button onclick="testSaveLoad()">ä¿å­˜/åŠ è½½æµ‹è¯•</button>
                <button onclick="addRandomItems()">æ·»åŠ éšæœºç‰©å“</button>
                <button onclick="clearInventory()" class="danger">æ¸…ç©ºç‰©å“æ </button>
                <button onclick="showInventoryState()">æ˜¾ç¤ºç‰©å“æ çŠ¶æ€</button>
            </div>
            
            <div class="test-output" id="testOutput"></div>
        </div>
        
        <div class="test-section">
            <h2>ç‰©å“æ æ¼”ç¤º</h2>
            <div class="inventory-demo">
                <div>
                    <h3>å¿«æ·æ  (å½“å‰é€‰ä¸­: <span id="selectedSlot">0</span>)</h3>
                    <div class="hotbar-demo" id="hotbarDemo"></div>
                    
                    <h3>èƒŒåŒ…</h3>
                    <div class="inventory-grid-demo" id="inventoryDemo"></div>
                    
                    <div class="test-controls">
                        <button onclick="selectSlot(0)">é€‰æ‹©æ§½ä½0</button>
                        <button onclick="selectSlot(1)">é€‰æ‹©æ§½ä½1</button>
                        <button onclick="selectSlot(2)">é€‰æ‹©æ§½ä½2</button>
                        <button onclick="selectSlot(3)">é€‰æ‹©æ§½ä½3</button>
                        <button onclick="selectSlot(4)">é€‰æ‹©æ§½ä½4</button>
                    </div>
                </div>
                
                <div class="inventory-info">
                    <h3>ç‰©å“æ ä¿¡æ¯</h3>
                    <div id="inventoryInfo">
                        <p>ç©ºæ§½ä½: <span id="emptySlots">36</span></p>
                        <p>æ€»æ§½ä½: <span id="totalSlots">36</span></p>
                        <p>å½“å‰æ‰‹æŒ: <span id="heldItem">æ— </span></p>
                    </div>
                    
                    <h3>å¿«é€Ÿæµ‹è¯•</h3>
                    <div class="test-controls">
                        <button onclick="addTestItem('pickaxe_wood')">æ·»åŠ æœ¨é•</button>
                        <button onclick="addTestItem('block_dirt', 64)">æ·»åŠ æ³¥åœŸx64</button>
                        <button onclick="addTestItem('apple', 10)">æ·»åŠ è‹¹æœx10</button>
                        <button onclick="addTestItem('diamond', 5)">æ·»åŠ é’»çŸ³x5</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¼å…¥ç‰©å“æ ç›¸å…³æ¨¡å— -->
    <script type="module">
        import { Inventory, ItemSlot } from './src/player/Inventory.js';
        import { itemConfig, ItemConfig } from './src/config/ItemConfig.js';
        
        // åˆ›å»ºå…¨å±€æµ‹è¯•å®ä¾‹
        window.testInventory = new Inventory();
        window.itemConfig = itemConfig;
        
        // æµ‹è¯•è¾“å‡ºå‡½æ•°
        function log(message) {
            const output = document.getElementById('testOutput');
            const now = new Date().toLocaleTimeString();
            output.innerHTML += `[${now}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        // åŸºç¡€æ“ä½œæµ‹è¯•
        window.testBasicOperations = function() {
            log('=== åŸºç¡€æ“ä½œæµ‹è¯•å¼€å§‹ ===');
            
            // æµ‹è¯•ç‰©å“æ·»åŠ 
            log('æµ‹è¯•æ·»åŠ ç‰©å“...');
            const remaining1 = window.testInventory.addItem('block_dirt', 10);
            log(`æ·»åŠ æ³¥åœŸx10ï¼Œå‰©ä½™: ${remaining1}`);
            
            const remaining2 = window.testInventory.addItem('pickaxe_wood', 1);
            log(`æ·»åŠ æœ¨é•x1ï¼Œå‰©ä½™: ${remaining2}`);
            
            // æµ‹è¯•ç‰©å“æ£€æŸ¥
            const hasItem1 = window.testInventory.hasItem('block_dirt', 5);
            log(`æ£€æŸ¥æ˜¯å¦æœ‰æ³¥åœŸx5: ${hasItem1}`);
            
            const hasItem2 = window.testInventory.hasItem('pickaxe_iron', 1);
            log(`æ£€æŸ¥æ˜¯å¦æœ‰é“é•x1: ${hasItem2}`);
            
            // æµ‹è¯•ç‰©å“ç§»é™¤
            const removed = window.testInventory.removeItem('block_dirt', 3);
            log(`ç§»é™¤æ³¥åœŸx3ï¼Œå®é™…ç§»é™¤: ${removed}`);
            
            updateDisplay();
            log('=== åŸºç¡€æ“ä½œæµ‹è¯•å®Œæˆ ===');
        };
        
        // å †å æ“ä½œæµ‹è¯•
        window.testStackOperations = function() {
            log('=== å †å æ“ä½œæµ‹è¯•å¼€å§‹ ===');
            
            // æµ‹è¯•å¯å †å ç‰©å“
            log('æµ‹è¯•å¯å †å ç‰©å“...');
            window.testInventory.addItem('block_stone', 30);
            window.testInventory.addItem('block_stone', 40);
            log('æ·»åŠ çŸ³å¤´30+40ä¸ª');
            
            // æµ‹è¯•ä¸å¯å †å ç‰©å“
            log('æµ‹è¯•ä¸å¯å †å ç‰©å“...');
            window.testInventory.addItem('pickaxe_stone', 1);
            window.testInventory.addItem('pickaxe_stone', 1);
            log('æ·»åŠ çŸ³é•1+1ä¸ª');
            
            updateDisplay();
            log('=== å †å æ“ä½œæµ‹è¯•å®Œæˆ ===');
        };
        
        // ç‰©å“æ æ“ä½œæµ‹è¯•
        window.testInventoryOperations = function() {
            log('=== ç‰©å“æ æ“ä½œæµ‹è¯•å¼€å§‹ ===');
            
            // æµ‹è¯•æ§½ä½é€‰æ‹©
            window.testInventory.setSelectedHotbarSlot(3);
            log('é€‰æ‹©å¿«æ·æ æ§½ä½3');
            
            const heldItem = window.testInventory.getHeldItem();
            if (!heldItem.isEmpty()) {
                const item = heldItem.getItemDefinition();
                log(`å½“å‰æ‰‹æŒ: ${item?.name || heldItem.itemId} x${heldItem.count}`);
            } else {
                log('å½“å‰æ‰‹æŒ: æ— ');
            }
            
            // æµ‹è¯•ç‰©å“æ çŠ¶æ€
            const emptySlots = window.testInventory.getEmptySlotCount();
            const isFull = window.testInventory.isFull();
            log(`ç©ºæ§½ä½æ•°é‡: ${emptySlots}`);
            log(`ç‰©å“æ æ˜¯å¦å·²æ»¡: ${isFull}`);
            
            updateDisplay();
            log('=== ç‰©å“æ æ“ä½œæµ‹è¯•å®Œæˆ ===');
        };
        
        // ä¿å­˜/åŠ è½½æµ‹è¯•
        window.testSaveLoad = function() {
            log('=== ä¿å­˜/åŠ è½½æµ‹è¯•å¼€å§‹ ===');
            
            // ä¿å­˜å½“å‰çŠ¶æ€
            const saveData = window.testInventory.toSaveData();
            log('ç‰©å“æ çŠ¶æ€å·²ä¿å­˜åˆ°å†…å­˜');
            
            // æ¸…ç©ºç‰©å“æ 
            window.testInventory.clear();
            log('ç‰©å“æ å·²æ¸…ç©º');
            updateDisplay();
            
            // ç­‰å¾…ä¸€ç§’åæ¢å¤
            setTimeout(() => {
                window.testInventory.fromSaveData(saveData);
                log('ç‰©å“æ çŠ¶æ€å·²æ¢å¤');
                updateDisplay();
                log('=== ä¿å­˜/åŠ è½½æµ‹è¯•å®Œæˆ ===');
            }, 1000);
        };
        
        // æ·»åŠ éšæœºç‰©å“
        window.addRandomItems = function() {
            const items = [
                'block_dirt', 'block_stone', 'block_grass', 'block_sand',
                'pickaxe_wood', 'pickaxe_stone', 'apple', 'bread',
                'iron_ingot', 'gold_ingot', 'diamond'
            ];
            
            for (let i = 0; i < 5; i++) {
                const randomItem = items[Math.floor(Math.random() * items.length)];
                const randomCount = Math.floor(Math.random() * 20) + 1;
                window.testInventory.addItem(randomItem, randomCount);
            }
            
            log('æ·»åŠ äº†5ä¸ªéšæœºç‰©å“');
            updateDisplay();
        };
        
        // æ¸…ç©ºç‰©å“æ 
        window.clearInventory = function() {
            window.testInventory.clear();
            log('ç‰©å“æ å·²æ¸…ç©º');
            updateDisplay();
        };
        
        // æ˜¾ç¤ºç‰©å“æ çŠ¶æ€
        window.showInventoryState = function() {
            log('=== ç‰©å“æ çŠ¶æ€ ===');
            window.testInventory.debugPrint();
            log('è¯¦ç»†çŠ¶æ€å·²è¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°');
        };
        
        // é€‰æ‹©æ§½ä½
        window.selectSlot = function(index) {
            window.testInventory.setSelectedHotbarSlot(index);
            updateDisplay();
            log(`é€‰æ‹©äº†å¿«æ·æ æ§½ä½ ${index}`);
        };
        
        // æ·»åŠ æµ‹è¯•ç‰©å“
        window.addTestItem = function(itemId, count = 1) {
            const remaining = window.testInventory.addItem(itemId, count);
            const item = window.itemConfig.getItem(itemId);
            if (remaining > 0) {
                log(`æ·»åŠ  ${item?.name || itemId} x${count - remaining}ï¼Œå‰©ä½™ ${remaining} ä¸ªæ— æ³•æ·»åŠ ï¼ˆç‰©å“æ å·²æ»¡ï¼‰`);
            } else {
                log(`æˆåŠŸæ·»åŠ  ${item?.name || itemId} x${count}`);
            }
            updateDisplay();
        };
        
        // è·å–ç‰©å“å›¾æ ‡
        function getItemIcon(item) {
            if (!item) return '';
            
            const iconMap = {
                'block_dirt': 'ğŸŸ«',
                'block_stone': 'â¬œ',
                'block_grass': 'ğŸŸ©',
                'block_sand': 'ğŸŸ¨',
                'block_water': 'ğŸŸ¦',
                'block_wood': 'ğŸŸ¤',
                'block_leaves': 'ğŸƒ',
                'block_iron_ore': 'âšª',
                'block_gold_ore': 'ğŸŸ¡',
                'block_diamond_ore': 'ğŸ’',
                'pickaxe_wood': 'â›ï¸',
                'pickaxe_stone': 'ğŸ”¨',
                'pickaxe_iron': 'âš’ï¸',
                'pickaxe_diamond': 'ğŸ’â›ï¸',
                'iron_ingot': 'ğŸ”—',
                'gold_ingot': 'ğŸ¥‡',
                'diamond': 'ğŸ’',
                'stick': 'ğŸªµ',
                'apple': 'ğŸ',
                'bread': 'ğŸ'
            };
            
            return iconMap[item.id] || 'â“';
        }
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const hotbarElement = document.getElementById('hotbarDemo');
            const inventoryElement = document.getElementById('inventoryDemo');
            
            // æ›´æ–°å¿«æ·æ 
            hotbarElement.innerHTML = '';
            window.testInventory.hotbar.forEach((slot, index) => {
                const slotElement = document.createElement('div');
                slotElement.className = `item-slot ${window.testInventory.selectedHotbarSlot === index ? 'selected' : ''}`;
                
                if (!slot.isEmpty()) {
                    const item = slot.getItemDefinition();
                    slotElement.innerHTML = `
                        <div class="item-icon">${getItemIcon(item)}</div>
                        <div class="item-count">${slot.count > 1 ? slot.count : ''}</div>
                    `;
                }
                
                slotElement.onclick = () => selectSlot(index);
                hotbarElement.appendChild(slotElement);
            });
            
            // æ›´æ–°èƒŒåŒ…
            inventoryElement.innerHTML = '';
            window.testInventory.mainInventory.forEach((slot, index) => {
                const slotElement = document.createElement('div');
                slotElement.className = 'item-slot';
                
                if (!slot.isEmpty()) {
                    const item = slot.getItemDefinition();
                    slotElement.innerHTML = `
                        <div class="item-icon">${getItemIcon(item)}</div>
                        <div class="item-count">${slot.count > 1 ? slot.count : ''}</div>
                    `;
                }
                
                inventoryElement.appendChild(slotElement);
            });
            
            // æ›´æ–°ä¿¡æ¯
            document.getElementById('selectedSlot').textContent = window.testInventory.selectedHotbarSlot;
            document.getElementById('emptySlots').textContent = window.testInventory.getEmptySlotCount();
            document.getElementById('totalSlots').textContent = window.testInventory.getAllSlots().length;
            
            const heldItem = window.testInventory.getHeldItem();
            if (!heldItem.isEmpty()) {
                const item = heldItem.getItemDefinition();
                document.getElementById('heldItem').textContent = `${item?.name || heldItem.itemId} x${heldItem.count}`;
            } else {
                document.getElementById('heldItem').textContent = 'æ— ';
            }
        }
        
        // åˆå§‹åŒ–æ˜¾ç¤º
        updateDisplay();
        log('ç‰©å“æ ç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½');
        log('è¯·ä½¿ç”¨ä¸Šæ–¹æŒ‰é’®æµ‹è¯•å„é¡¹åŠŸèƒ½');
        
        window.log = log;
        window.updateDisplay = updateDisplay;
    </script>
</body>
</html>