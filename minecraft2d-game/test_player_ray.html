<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>玩家射线显示测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .test-button:hover {
            background-color: #45a049;
        }
        .test-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .log {
            background-color: #000;
            color: #00ff00;
            padding: 10px;
            font-family: 'Courier New', monospace;
            height: 200px;
            overflow-y: auto;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎮 玩家射线显示功能测试</h1>
        
        <div class="test-section">
            <h2>测试说明</h2>
            <p>本测试用于验证玩家射线显示功能是否正常工作：</p>
            <ul>
                <li>检查开发者选项中的射线显示配置是否正确</li>
                <li>验证射线在游戏中的可视化效果</li>
                <li>测试不同射线参数的配置效果</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h2>测试步骤</h2>
            <div id="status" class="status info">
                请按照以下步骤进行测试：
                <ol>
                    <li>打开游戏并进入开发者模式</li>
                    <li>按F2打开配置面板</li>
                    <li>切换到"开发者选项"标签页</li>
                    <li>启用"显示视线射线"选项</li>
                    <li>观察玩家角色是否显示射线</li>
                </ol>
            </div>
            
            <h3>配置测试</h3>
            <button id="testConfig" class="test-button">检查配置</button>
            <button id="enableRay" class="test-button">启用射线显示</button>
            <button id="disableRay" class="test-button">禁用射线显示</button>
            
            <h3>参数测试</h3>
            <button id="testLength" class="test-button">测试射线长度</button>
            <button id="testColor" class="test-button">测试射线颜色</button>
            <button id="testWidth" class="test-button">测试射线宽度</button>
        </div>
        
        <div class="test-section">
            <h2>测试日志</h2>
            <div id="log" class="log"></div>
            <button id="clearLog" class="test-button">清空日志</button>
        </div>
    </div>

    <script>
        // 日志记录函数
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // 更新状态显示
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.className = `status ${type}`;
            statusElement.innerHTML = message;
        }
        
        // 测试配置
        document.getElementById('testConfig').addEventListener('click', function() {
            log('开始检查配置...');
            
            try {
                // 检查全局gameConfig是否存在
                if (typeof window.gameConfig !== 'undefined') {
                    log('✅ 全局gameConfig可用');
                    
                    // 检查开发者选项配置
                    const developerConfig = window.gameConfig.getConfig('developer');
                    if (developerConfig) {
                        log('✅ 开发者选项配置存在');
                        log(`配置项: ${Object.keys(developerConfig.settings).join(', ')}`);
                        
                        // 检查具体的射线配置项
                        const showPlayerRay = window.gameConfig.get('developer', 'showPlayerRay');
                        const playerRayLength = window.gameConfig.get('developer', 'playerRayLength');
                        const playerRayColor = window.gameConfig.get('developer', 'playerRayColor');
                        const playerRayWidth = window.gameConfig.get('developer', 'playerRayWidth');
                        
                        log(`显示射线: ${showPlayerRay}`);
                        log(`射线长度: ${playerRayLength}`);
                        log(`射线颜色: ${playerRayColor}`);
                        log(`射线宽度: ${playerRayWidth}`);
                        
                        updateStatus('配置检查完成，所有配置项都存在', 'success');
                    } else {
                        log('❌ 开发者选项配置不存在');
                        updateStatus('开发者选项配置不存在', 'error');
                    }
                } else {
                    log('❌ 全局gameConfig不可用');
                    updateStatus('全局gameConfig不可用', 'error');
                }
            } catch (error) {
                log(`❌ 配置检查失败: ${error.message}`);
                updateStatus(`配置检查失败: ${error.message}`, 'error');
            }
        });
        
        // 启用射线显示
        document.getElementById('enableRay').addEventListener('click', function() {
            log('尝试启用射线显示...');
            
            try {
                if (typeof window.gameConfig !== 'undefined') {
                    window.gameConfig.set('developer', 'showPlayerRay', true);
                    log('✅ 射线显示已启用');
                    updateStatus('射线显示已启用，请在游戏中观察效果', 'success');
                } else {
                    log('❌ 无法启用射线显示：gameConfig不可用');
                    updateStatus('无法启用射线显示：gameConfig不可用', 'error');
                }
            } catch (error) {
                log(`❌ 启用射线显示失败: ${error.message}`);
                updateStatus(`启用射线显示失败: ${error.message}`, 'error');
            }
        });
        
        // 禁用射线显示
        document.getElementById('disableRay').addEventListener('click', function() {
            log('尝试禁用射线显示...');
            
            try {
                if (typeof window.gameConfig !== 'undefined') {
                    window.gameConfig.set('developer', 'showPlayerRay', false);
                    log('✅ 射线显示已禁用');
                    updateStatus('射线显示已禁用', 'success');
                } else {
                    log('❌ 无法禁用射线显示：gameConfig不可用');
                    updateStatus('无法禁用射线显示：gameConfig不可用', 'error');
                }
            } catch (error) {
                log(`❌ 禁用射线显示失败: ${error.message}`);
                updateStatus(`禁用射线显示失败: ${error.message}`, 'error');
            }
        });
        
        // 测试射线长度
        document.getElementById('testLength').addEventListener('click', function() {
            log('测试射线长度配置...');
            
            try {
                if (typeof window.gameConfig !== 'undefined') {
                    // 测试不同的长度值
                    const lengths = [4, 8, 16, 32];
                    let currentLength = window.gameConfig.get('developer', 'playerRayLength') || 8;
                    
                    // 找到下一个长度值
                    let nextIndex = lengths.indexOf(currentLength);
                    if (nextIndex === -1 || nextIndex === lengths.length - 1) {
                        nextIndex = 0;
                    } else {
                        nextIndex++;
                    }
                    
                    const nextLength = lengths[nextIndex];
                    window.gameConfig.set('developer', 'playerRayLength', nextLength);
                    log(`✅ 射线长度已设置为: ${nextLength}`);
                    updateStatus(`射线长度已设置为: ${nextLength}，请在游戏中观察效果`, 'success');
                } else {
                    log('❌ 无法测试射线长度：gameConfig不可用');
                    updateStatus('无法测试射线长度：gameConfig不可用', 'error');
                }
            } catch (error) {
                log(`❌ 测试射线长度失败: ${error.message}`);
                updateStatus(`测试射线长度失败: ${error.message}`, 'error');
            }
        });
        
        // 测试射线颜色
        document.getElementById('testColor').addEventListener('click', function() {
            log('测试射线颜色配置...');
            
            try {
                if (typeof window.gameConfig !== 'undefined') {
                    // 测试不同的颜色值
                    const colors = ['#00FFFF', '#FF0000', '#00FF00', '#FFFF00', '#FF00FF'];
                    let currentColor = window.gameConfig.get('developer', 'playerRayColor') || '#00FFFF';
                    
                    // 找到下一个颜色值
                    let nextIndex = colors.indexOf(currentColor);
                    if (nextIndex === -1 || nextIndex === colors.length - 1) {
                        nextIndex = 0;
                    } else {
                        nextIndex++;
                    }
                    
                    const nextColor = colors[nextIndex];
                    window.gameConfig.set('developer', 'playerRayColor', nextColor);
                    log(`✅ 射线颜色已设置为: ${nextColor}`);
                    updateStatus(`射线颜色已设置为: ${nextColor}，请在游戏中观察效果`, 'success');
                } else {
                    log('❌ 无法测试射线颜色：gameConfig不可用');
                    updateStatus('无法测试射线颜色：gameConfig不可用', 'error');
                }
            } catch (error) {
                log(`❌ 测试射线颜色失败: ${error.message}`);
                updateStatus(`测试射线颜色失败: ${error.message}`, 'error');
            }
        });
        
        // 测试射线宽度
        document.getElementById('testWidth').addEventListener('click', function() {
            log('测试射线宽度配置...');
            
            try {
                if (typeof window.gameConfig !== 'undefined') {
                    // 测试不同的宽度值
                    const widths = [1, 2, 4, 6, 8];
                    let currentWidth = window.gameConfig.get('developer', 'playerRayWidth') || 2;
                    
                    // 找到下一个宽度值
                    let nextIndex = widths.indexOf(currentWidth);
                    if (nextIndex === -1 || nextIndex === widths.length - 1) {
                        nextIndex = 0;
                    } else {
                        nextIndex++;
                    }
                    
                    const nextWidth = widths[nextIndex];
                    window.gameConfig.set('developer', 'playerRayWidth', nextWidth);
                    log(`✅ 射线宽度已设置为: ${nextWidth}`);
                    updateStatus(`射线宽度已设置为: ${nextWidth}，请在游戏中观察效果`, 'success');
                } else {
                    log('❌ 无法测试射线宽度：gameConfig不可用');
                    updateStatus('无法测试射线宽度：gameConfig不可用', 'error');
                }
            } catch (error) {
                log(`❌ 测试射线宽度失败: ${error.message}`);
                updateStatus(`测试射线宽度失败: ${error.message}`, 'error');
            }
        });
        
        // 清空日志
        document.getElementById('clearLog').addEventListener('click', function() {
            document.getElementById('log').innerHTML = '';
        });
        
        // 初始化
        log('玩家射线显示测试工具已加载');
        updateStatus('测试工具已就绪，请点击相应按钮开始测试', 'info');
    </script>
</body>
</html>